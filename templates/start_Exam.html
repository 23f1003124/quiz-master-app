<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quiz-Exam</title>
  <link rel="stylesheet" href="/static/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .question-container {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }
    .question-title {
      font-weight: bold;
      margin-bottom: 10px;
    }
    .options {
      list-style: none;
      padding: 0;
    }
    .options li {
      padding: 5px 0;
    }
  </style>
</head>
<body>
  <div class="container mt-4">
    <h1 style="text-align:center;">{{ sub_name }}</h1>
    <h4 style="text-align:center;">{{ chapter_name }}</h4>
    <div id="timer" class="text-center mb-3">Time Remaining: <span id="time">00:00</span></div>
    
    <form action="/submit/{{ quiz_id }}" method="POST" id="new-question-form">
      {% for question in questions %}
        <div class="question-container">
          <div class="question-title">
            Q{{ loop.index }}: {{ question.question_statement }}
          </div>
          <ul class="options">
            <li>
              <input type="radio" id="q{{ question.id }}_1" name="question_{{ question.id }}" value="1">
              <label for="q{{ question.id }}_1">{{ question.option_1 }}</label>
            </li>
            <li>
              <input type="radio" id="q{{ question.id }}_2" name="question_{{ question.id }}" value="2">
              <label for="q{{ question.id }}_2">{{ question.option_2 }}</label>
            </li>
            <li>
              <input type="radio" id="q{{ question.id }}_3" name="question_{{ question.id }}" value="3">
              <label for="q{{ question.id }}_3">{{ question.option_3 }}</label>
            </li>
            <li>
              <input type="radio" id="q{{ question.id }}_4" name="question_{{ question.id }}" value="4">
              <label for="q{{ question.id }}_4">{{ question.option_4 }}</label>
            </li>
          </ul>
        </div>
      {% endfor %}

      <input type="hidden" id="completion_time" name="submit_time" value="">

      <div class="footer-start-exam">
        <button type="submit" class="btn btn-primary" style="padding:10px; margin:10px;">Submit</button>
      </div>
    </form>
  </div>

  <script>
    
    let timerInterval;
  
    function startTimer(duration, display) {
      
      let timer = duration;
      timerInterval = setInterval(function () {
        
        let totalSeconds = Math.ceil(timer);
        let minutes = Math.floor(totalSeconds / 60);
        let seconds = totalSeconds % 60;
  
        
        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;
        display.textContent = minutes + ":" + seconds;

        timer -= 1;
  
        if (timer < 0) {
          clearInterval(timerInterval);
          document.getElementById("timer").innerText = "Time's up!";
          setTimeout(function(){
            submitExam();
          }, 100);
        }
      }, 1000);
    }
  
    function submitExam() {
      console.log("Auto-submit triggered.");
      const completionTime = new Date();
      document.getElementById("completion_time").value = completionTime.toISOString();
      const form = document.getElementById("new-question-form");
      if (form) {
        form.submit();
      } else {
        console.error("Form not found! Ensure the form ID is correct.");
      }
    }
  
    window.onload = function () {
      const quizDuration = 1800; 
      const display = document.querySelector('#time');
      startTimer(quizDuration, display);
  
      document.getElementById("new-question-form").addEventListener("submit", function() {
        const completionTime = new Date();
        document.getElementById("completion_time").value = completionTime.toISOString();
        console.log("Submit time set to:", completionTime.toISOString());
      });
    };
  </script>
  
    
</body>
</html>